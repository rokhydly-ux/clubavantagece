<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Avantage CE - Central Equipements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .hidden { display: none; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .loading-spinner { animation: spin 1s linear infinite; }
        /* ... collez ici vos autres styles @keyframes ... */
    </style>
</head>
<body class="min-h-screen">

    <!-- Écran de chargement (GARDEZ-LE TEL QUEL) -->
    <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="loading-spinner w-16 h-16 border-4 border-white border-t-transparent rounded-full mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold mb-2">Club Avantage CE</h2>
            <p class="text-blue-200">Chargement de votre espace membre...</p>
        </div>
    </div>

    <!-- Header (GARDEZ-LE TEL QUEL) -->
    <header id="app-header" class="bg-white shadow-lg p-4 text-center hidden">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
            <div class="w-24"></div>
            <div class="text-center">
                <h2 class="text-lg font-bold text-black">Club Avantage CE</h2>
                <p class="text-xs text-gray-600">Votre fidélité récompensée</p>
            </div>
            <button id="logout-btn" class="bg-red-500 text-white px-3 py-2 rounded-lg text-sm" style="display: none;">Déconnexion</button>
        </div>
    </header>

    <!-- Contenu Principal -->
    <main id="app-content" class="hidden min-h-screen" style="background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://deegreez.fr/wp-content/uploads/2023/10/quel-budget-pour-une-cuisine-professionnelle-scaled.jpeg'); background-size: cover; background-position: center; background-attachment: fixed;">
        
        <!-- ÉCRAN D'AUTHENTIFICATION -->
        <div id="auth-screen">
            <!-- ============================================= -->
            <!-- == COLLEZ VOTRE CODE HTML POUR AUTH-SCREEN ICI == -->
            <!-- ============================================= -->
        </div>

        <!-- ÉCRAN DE LA CARTE MEMBRE -->
        <div id="card-screen" class="hidden">
            <!-- ============================================== -->
            <!-- == COLLEZ VOTRE CODE HTML POUR CARD-SCREEN ICI == -->
            <!-- ============================================== -->
        </div>
    </main>

    <!-- SECTION SCRIPTS (NE MODIFIEZ RIEN ICI) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // --- A. CONFIGURATION FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDFuZRS1M_ATwTRxsbW8Jlv0m7H9dnjxjY",
            authDomain: "clubavantage-52aed.firebaseapp.com",
            projectId: "clubavantage-52aed",
            storageBucket: "clubavantage-52aed.appspot.com",
            messagingSenderId: "655040433691",
            appId: "1:655040433691:web:e3492b4fb64333ff01b2be",
            measurementId: "G-Y0187YGWCT"
        };
        firebase.initializeApp(firebaseConfig);

        // --- B. VARIABLES GLOBALES ---
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // DOM Elements - Déclarés ici, vérifiés avant utilisation
        let currentUser = null;
        let userDataListener = null;

        // --- C. POINT D'ENTRÉE ---
        auth.onAuthStateChanged((user) => {
            hideLoadingScreen();
            if (user) {
                currentUser = user;
                showCardScreen();
                loadUserData();
                generateQRCode(user.uid);
                document.getElementById('logout-btn').style.display = 'block';
            } else {
                currentUser = null;
                showAuthScreen();
                document.getElementById('logout-btn').style.display = 'none';
            }
        });

        // --- D. GESTIONNAIRES D'ÉVÉNEMENTS (attachés après le chargement du DOM) ---
        document.addEventListener('DOMContentLoaded', () => {
            const signupForm = document.getElementById('signup-form');
            if (signupForm) {
                signupForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    // ... votre logique d'inscription ...
                });
            }

            const signinForm = document.getElementById('signin-form');
            if (signinForm) {
                signinForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    // ... votre logique de connexion ...
                });
            }
            
            const logoutBtn = document.getElementById('logout-btn');
            if(logoutBtn) {
                logoutBtn.a
