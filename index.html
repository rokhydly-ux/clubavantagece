<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Avantage CE - Central Equipements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* ... collez ici l'intégralité de vos styles CSS ... */
        body { font-family: 'Poppins', sans-serif; /* ... etc. */ }
        .hidden { display: none; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(300deg); } }
        /* ... etc. */
    </style>
</head>
<body class="min-h-screen">
    <!-- Écran de chargement -->
    <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center z-50">
        <!-- ... votre HTML pour l'écran de chargement ... -->
    </div>

    <!-- Header -->
    <header id="app-header" class="bg-white shadow-lg p-4 text-center hidden">
        <!-- ... votre HTML pour le header ... -->
    </header>

    <!-- Contenu Principal -->
    <main id="app-content" class="hidden min-h-screen" style="background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https-url-background.jpeg');">
        <!-- Écran d'authentification -->
        <div id="auth-screen">
             <!-- ... collez ici votre HTML pour la section #auth-screen ... -->
        </div>

        <!-- Écran de la carte membre -->
        <div id="card-screen" class="hidden">
            <!-- ... collez ici votre HTML pour la section #card-screen ... -->
        </div>
    </main>

    <!-- ======================= SECTION SCRIPTS ======================= -->
    
    <!-- 1. CHARGEMENT DES LIBRAIRIES EXTERNES -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- 2. SCRIPT COMPLET DE VOTRE APPLICATION -->
    <script>
        // --- A. CONFIGURATION FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDFuZRS1M_ATwTRxsbW8Jlv0m7H9dnjxjY",
            authDomain: "clubavantage-52aed.firebaseapp.com",
            projectId: "clubavantage-52aed",
            storageBucket: "clubavantage-52aed.appspot.com",
            messagingSenderId: "655040433691",
            appId: "1:655040433691:web:e3492b4fb64333ff01b2be",
            measurementId: "G-Y0187YGWCT"
        };
        firebase.initializeApp(firebaseConfig);

        // --- B. VARIABLES GLOBALES (après l'initialisation de Firebase) ---
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // DOM Elements
        const loadingScreen = document.getElementById('loading-screen');
        const appHeader = document.getElementById('app-header');
        const appContent = document.getElementById('app-content');
        const authScreen = document.getElementById('auth-screen');
        const cardScreen = document.getElementById('card-screen');
        const signupForm = document.getElementById('signup-form');
        const signinForm = document.getElementById('signin-form');
        const logoutBtn = document.getElementById('logout-btn');
        // ... (ajoutez ici les autres getElementById)

        let currentUser = null;
        let userDataListener = null;

        // --- C. POINT D'ENTRÉE DE L'APPLICATION ---
        auth.onAuthStateChanged((user) => {
            hideLoadingScreen();
            if (user) {
                currentUser = user;
                showCardScreen();
                loadUserData();
                generateQRCode(user.uid);
                logoutBtn.style.display = 'flex'; // CORRECTION : Utiliser style.display
            } else {
                currentUser = null;
                showAuthScreen();
                logoutBtn.style.display = 'none'; // CORRECTION : Utiliser style.display
            }
        });

        // --- D. GESTIONNAIRES D'ÉVÉNEMENTS ---
        signupForm.addEventListener('submit', async (e) => {
             e.preventDefault();
             // ... (votre logique d'inscription - inchangée)
        });

        signinForm.addEventListener('submit', async (e) => {
             e.preventDefault();
             // ... (votre logique de connexion - inchangée)
        });

        logoutBtn.addEventListener('click', () => {
             if (userDataListener) {
                 userDataListener(); // Détache l'écouteur
                 userDataListener = null;
             }
             auth.signOut();
        });

        // --- E. FONCTIONS UTILITAIRES ---
        function switchTab(tab) {
             // ... (votre fonction switchTab - inchangée)
        }

        function loadUserData() {
            if (!currentUser) return;
            if (userDataListener) userDataListener(); // Détacher l'ancien écouteur
            userDataListener = db.collection('users').doc(currentUser.uid).onSnapshot((doc) => {
                if (doc.exists) {
                    updateUserInterface(doc.data());
                    loadRecentActivity();
                }
            });
        }
        
        function updateUserInterface(userData) {
            // CORRECTION : S'assurer que les éléments existent avant de les manipuler
            document.getElementById('member-name').textContent = `${userData.prenom} ${userData.nom}`;
            document.getElementById('member-email').textContent = userData.email;
            if (userData.createdAt && userData.createdAt.toDate) {
                const date = userData.createdAt.toDate();
                document.getElementById('member-since').textContent = date.toLocaleDateString('fr-FR');
            }
            // ... (votre logique d'update - inchangée)
        }
        
        function generateQRCode(userId) {
            const canvas = document.getElementById('qr-code');
            if (!canvas) return; // Sécurité
            const qrData = JSON.stringify({ userId, type: 'club_member' });
            QRCode.toCanvas(canvas, qrData, { /* ... options ... */ });
        }

        function hideLoadingScreen() {
            loadingScreen.style.display = 'none'; // CORRECTION : Utiliser style.display
            appHeader.classList.remove('hidden');
            appContent.classList.remove('hidden');
        }

        function showAuthScreen() {
            authScreen.classList.remove('hidden');
            cardScreen.classList.add('hidden');
        }

        function showCardScreen() {
            cardScreen.classList.remove('hidden');
            authScreen.classList.add('hidden');
        }
        
        // ... (collez ici toutes vos autres fonctions : loadRecentActivity, createActivityElement, etc.)
    </script>
</body>
</html>
