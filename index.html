<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Avantage CE - Central Equipements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .hidden { display: none; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .pulse-animation { animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- √âCRAN DE CHARGEMENT -->
    <div id="loading-screen" class="fixed inset-0 bg-white flex flex-col justify-center items-center z-50">
        <img src="https://jokkootech.com/wp-content/uploads/elementor/thumbs/CENTRAL_EQUIPEMENT-1-removebg-preview-qmtu95vg6ca8in6ds4b6xx9yzi550nl7zpyzehgycc.webp" alt="Logo" class="h-20 mb-4 animate-pulse">
        <p class="text-gray-600">Chargement de votre espace...</p>
    </div>

    <!-- CONTENEUR PRINCIPAL DE L'APPLICATION (initialement cach√©) -->
    <div id="app-container" class="hidden">
        <div class="min-h-screen bg-cover bg-center bg-fixed" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://www.groupesebi.com/wp-content/uploads/2020/04/cuisine-whole-sebi-paris-idf-normandie-1-uai-1600x685.jpg');">
            
            <!-- √âCRAN D'INSCRIPTION / CONNEXION -->
            <div id="auth-screen">
                <main class="flex-1 px-4 py-8 space-y-8">
                    <div class="text-center space-y-4">
                        <h2 class="text-3xl font-black tracking-wide text-white">Rejoignez le Club Avantage CE !</h2>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6">
                        <div id="form-container">
                            <!-- Inscription (par d√©faut) -->
                            <form id="signup-form" class="space-y-4">
                                <h3 class="text-2xl font-bold text-center" style="color: #22a8dc;">üìù Inscription Gratuite</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" id="signup-prenom" placeholder="Pr√©nom *" required class="w-full px-4 py-3 rounded-xl border">
                                    <input type="text" id="signup-nom" placeholder="Nom *" required class="w-full px-4 py-3 rounded-xl border">
                                </div>
                                <input type="email" id="signup-email" placeholder="Email (pour vous connecter)" class="w-full px-4 py-3 rounded-xl border">
                                <input type="tel" id="signup-telephone" placeholder="T√©l√©phone (pour vous connecter)" class="w-full px-4 py-3 rounded-xl border">
                                <input type="password" id="signup-password" placeholder="Mot de passe *" required class="w-full px-4 py-3 rounded-xl border">
                                <button type="submit" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl">üéÅ M'inscrire et obtenir mon bonus</button>
                            </form>
                            <!-- Connexion (cach√©) -->
                            <form id="login-form" class="hidden space-y-4">
                                <h3 class="text-2xl font-bold text-center" style="color: #22a8dc;">üëã Content de vous revoir !</h3>
                                <input type="text" id="login-identifier" placeholder="Email ou T√©l√©phone" required class="w-full px-4 py-3 rounded-xl border">
                                <input type="password" id="login-password" placeholder="Mot de passe" required class="w-full px-4 py-3 rounded-xl border">
                                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl">Se Connecter</button>
                            </form>
                        </div>
                        <p id="auth-message" class="text-sm text-red-500 mt-4 h-4 text-center"></p>
                        <p class="text-sm text-gray-500 mt-4 text-center">
                            <span id="login-text">D√©j√† membre ? <a href="#" id="toggle-form" class="font-semibold text-blue-600">Connectez-vous</a></span>
                            <span id="signup-text" class="hidden">Pas encore membre ? <a href="#" id="toggle-form-back" class="font-semibold text-blue-600">Inscrivez-vous</a></span>
                        </p>
                    </div>
                </main>
            </div>

            <!-- √âCRAN DE LA CARTE VIRTUELLE -->
            <div id="card-screen" class="hidden">
                 <main class="flex-1 px-4 py-8 space-y-8">
                    <header class="flex justify-between items-center text-white">
                        <h2 class="text-xl font-bold">Bonjour, <span id="user-name"></span> !</h2>
                        <button id="logout-button" class="text-sm opacity-80 hover:opacity-100">D√©connexion</button>
                    </header>
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-lg p-6 text-center text-white">
                        <p class="font-semibold">Votre solde de points</p>
                        <p id="user-points" class="text-6xl font-black my-4">...</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
                        <p class="font-semibold text-gray-700 mb-4">Pr√©sentez ce QR Code en caisse</p>
                        <div id="qrcode-container" class="bg-white p-2 rounded-xl inline-block shadow-inner"></div>
                    </div>
                 </main>
            </div>
        </div>
    </div>
    
    <!-- SCRIPTS FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // --- COLLEZ VOTRE CONFIGURATION FIREBASE ICI ---
        const firebaseConfig = {
            apiKey: "VOTRE_API_KEY",
            authDomain: "VOTRE_AUTH_DOMAIN",
            projectId: "VOTRE_PROJECT_ID",
            storageBucket: "VOTRE_STORAGE_BUCKET",
            messagingSenderId: "VOTRE_MESSAGING_SENDER_ID",
            appId: "VOTRE_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- √âL√âMENTS DU DOM ---
        const loadingScreen = document.getElementById('loading-screen');
        const appContainer = document.getElementById('app-container');
        const authScreen = document.getElementById('auth-screen');
        const cardScreen = document.getElementById('card-screen');
        const signupForm = document.getElementById('signup-form');
        const loginForm = document.getElementById('login-form');
        const authMessage = document.getElementById('auth-message');
        const userNameDisplay = document.getElementById('user-name');
        const userPointsDisplay = document.getElementById('user-points');
        const qrcodeContainer = document.getElementById('qrcode-container');
        const logoutButton = document.getElementById('logout-button');
        const toggleLinks = [document.getElementById('toggle-form'), document.getElementById('toggle-form-back')];

        // --- GESTION DE L'AUTHENTIFICATION ---
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('users').doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        displayCardScreen(doc.data());
                    }
                }, error => console.error("Erreur de lecture Firestore:", error));
            } else {
                displayAuthScreen();
            }
            loadingScreen.classList.add('hidden');
            appContainer.classList.remove('hidden');
        });

        // --- GESTION DES FORMULAIRES ---
        signupForm.addEventListener('submit', e => {
            e.preventDefault();
            const prenom = document.getElementById('signup-prenom').value.trim();
            const nom = document.getElementById('signup-nom').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const telephone = document.getElementById('signup-telephone').value.trim();
            const password = document.getElementById('signup-password').value;

            if (!email) {
                authMessage.textContent = "L'email est requis pour cr√©er un compte.";
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        nom: nom, prenom: prenom, email: email, telephone: telephone,
                        points: 50, createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .catch(error => { authMessage.textContent = error.message; });
        });

        loginForm.addEventListener('submit', e => {
            e.preventDefault();
            const identifier = document.getElementById('login-identifier').value.trim();
            const password = document.getElementById('login-password').value;
            auth.signInWithEmailAndPassword(identifier, password)
                .catch(error => { authMessage.textContent = "Identifiant ou mot de passe incorrect."; });
        });
        
        logoutButton.addEventListener('click', () => auth.signOut());

        toggleLinks.forEach(link => link.addEventListener('click', e => {
            e.preventDefault();
            signupForm.classList.toggle('hidden');
            loginForm.classList.toggle('hidden');
            document.getElementById('login-text').classList.toggle('hidden');
            document.getElementById('signup-text').classList.toggle('hidden');
            authMessage.textContent = '';
        }));

        // --- FONCTIONS D'AFFICHAGE ---
        function displayAuthScreen() {
            authScreen.classList.remove('hidden');
            cardScreen.classList.add('hidden');
        }

        function displayCardScreen(userData) {
            authScreen.classList.add('hidden');
            cardScreen.classList.remove('hidden');
            userNameDisplay.textContent = userData.prenom;
            userPointsDisplay.textContent = userData.points;
            generateQRCode(auth.currentUser.uid);
        }

        function generateQRCode(text) {
            qrcodeContainer.innerHTML = "";
            new QRCode(qrcodeContainer, { text, width: 180, height: 180 });
        }
    </script>
</body>
</html>
